/* This router get the information about artifacts from all the museums*/
/* The datastring variable is a SPARQL query */

const express = require('express');
const router = express.Router();
// Get the configuration options like header file and museum URLS
const configoptions = require('../config.json');
// include http request function that fetch the dtaa via HTTP(s) request
const fetchDataFromEndPoint = require('./fetchDataFromEndPoint.js');
const jsonld = require('jsonld');
const jsonPrimer = require('../primer/linked-art.json');

let options = { method: 'POST',
    url: configoptions.url,
    headers: configoptions.headers};


/*get all the manmade objects  */
router.get('/', function(req, res, next) {
    const offSet = req.query.offset;
    const limit = req.query.limit;
    let dataString = 'PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>' +
                     '\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>' +
                     '\nPREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>' +
                     '\nSELECT ?sub ?name WHERE {\n  ?sub rdf:type  crm:E22_Man-Made_Object.' +
                     '\n  ?sub rdfs:label ?name\n  \n}\nORDER BY (LCASE(?name)) ' +
                     '\nLIMIT' + limit + '\n OFFSET ' + offSet;

    options.form =  { query:  dataString } ;

    fetchDataFromEndPoint.getData(options, function(err, results) {
        if (err) {
            console.log(err.stack);
            return res.status(500);
        }
        res.json(results);
    });
});

/* Get a detail about a man made object */

router.get('/institution/:institution/id/:id', function(req, res, next){
    const institution = req.params.institution;
    const oid = req.params.id;
    const urlVar = configoptions.museums[institution].objectURL+ oid;
    let dataString = 'PREFIX owl: <http://www.w3.org/2002/07/owl#>\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\nPREFIX skos: <http://www.w3.org/2004/02/skos/core#>\nPREFIX xsd: <http://www.w3.org/2001/XMLSchema#>\nPREFIX foaf: <http://xmlns.com/foaf/0.1/>\nPREFIX dct: <http://purl.org/dc/terms/>\nPREFIX dc: <http://purl.org/dc/elements/1.1/>\nPREFIX schema: <http://schema.org/>\nPREFIX aat: <http://vocab.getty.edu/aat/>\nPREFIX ulan: <http://vocab.getty.edu/ulan/>\nPREFIX gvp: <http://vocab.getty.edu/ontology#>\nPREFIX dcterms: <http://purl.org/dc/terms/>\n\nCONSTRUCT {\n  ?entity_uri a crm:E22_Man-Made_Object ;\n  rdfs:label                         ?primary_title_text ;\n  foaf:homepage                      ?website_url ;\n  schema:genre                       ?style_name ;\n  crm:P24i_changed_ownership_through ?acquisition_event ;\n  crm:P102_has_title                 ?alternate_title_class ;\n  crm:P102_has_title                 ?primary_title_class ;\n  crm:P108i_was_produced_by          ?production_event ;\n  crm:P129i_is_subject_of            ?primary_description_class ;\n  crm:P129i_is_subject_of            ?alternate_description_class ;\n  crm:P138i_has_representation       ?image ;\n  crm:P1_is_identified_by            ?accession_number_class ;\n  crm:P1_is_identified_by            ?object_id_class ;\n  crm:P1_is_identified_by            ?alternate_ids;\n  crm:P1_is_identified_by ?preferred_identifier_class;\n  crm:P41i_was_classified_by         ?classification_event ;\n  crm:P41i_was_classified_by         ?style_event;\n  crm:P43_has_dimension              ?dimension_class ;\n  crm:P46_is_composed_of             ?part_class ;\n  crm:P52_has_current_owner          ?owner ;\n  crm:P62_depicts                    ?subject_class ;\n  crm:P65_shows_visual_item          ?inscription_class ;\n  crm:P65_shows_visual_item          ?mark_class ;\n  crm:P67i_is_referred_to_by         ?credit_line_class ;\n  crm:P46i_forms_part_of             ?collection_class ;\n  crm:P67i_is_referred_to_by         ?dimension_reference_class ;\n  crm:P104_is_subject_to             ?object_right ;\n  crm:P45_consists_of                ?material_class ;\n  crm:P67i_is_referred_to_by         ?material_string_class .\n\n\n\n######### PRIMARY TITLE #########\n?primary_title_class a crm:E35_Title ;\n  rdf:value ?primary_title_text ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300404670> ;\n  crm:P1_is_identified_by ?primary_title_id_class.\n?primary_title_id_class a crm:E42_Identifier ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300404012> ;\n  rdf:value ?primary_title_id .\n\n\n######### ALTERNATE TITLES #########\n?alternate_title_class a crm:E35_Title ;\n  rdf:value ?alternate_title_text ;\n  crm:P2_has_type ?alternate_title_type_class .\n?alternate_title_type_class a crm:E55_Type ;\n  skos:prefLabel ?alternate_title_type .\n\n\n######### OBJECT ID #########\n?object_id_class a crm:E42_Identifier ;\n  rdfs:label ?object_id ;\n  rdf:value  ?object_id ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300404621> .\n\n?preferred_identifier_class a crm:E42_Identifier ;\n    rdfs:label ?preferred_identifier ;\n    rdf:value ?preferred_identifier ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300404670> .\n\n######### ALTERNATE IDS #########\n?alternate_ids a crm:E42_Identifier ;\n  rdfs:label ?alternate_identifier ;\n  rdf:value  ?alternate_identifier ;\n  crm:P2_has_type ?alternate_identifier_type .\n?alternate_identifier_type a crm:E55_Type ;\n  skos:prefLabel ?alternate_identifier_type_label .\n\n######### CREATION #########\n?production_event a crm:E12_Production ;\n  crm:P4_has_time-span ?production_timespan. \n?production_timespan a crm:E52_Time-Span;\n  crm:P82a_begin_of_the_begin ?earliest_date;\n  crm:P82b_end_of_the_end ?latest_date;\n  rdfs:label ?display_date.   \n\n\n######### CREATOR #########\n?production_event crm:P14_carried_out_by ?actor_class .\n?actor_class a ?actor_type ;\n  rdfs:label ?actor_name.\n\n######### CREATION LOCATION #########\n?production_event crm:P7_took_place_at ?creation_location_class .\n?creation_location_class a crm:E53_Place ;\n  rdfs:label ?creation_location.\n\n\n######### ACCESSION NUMBER #########\n?accession_number_class a crm:E42_Identifier ;\n  rdfs:label ?identifier ;\n  rdf:value  ?identifier ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300312355> . \n\n\n######### CLASSIFICATION #########\n?classification_event a crm:E17_Type_Assignment ;\n  crm:P21_had_general_purpose <http://vocab.getty.edu/aat/300179869> ;\n  crm:P42_assigned ?classification_class .\n?classification_class a crm:E55_Type;\n  rdfs:label ?classification_name .\n\n\n######### SUBJECT #########\n?subject_class rdfs:label ?subject_name .\n\n\n######### CREDIT_LINE #########\n?credit_line_class a crm:E33_Linguistic_Object;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300026687>;  \n  rdf:value ?credit_line .\n\n\n######### MEDIUM_STATEMENT #########\n?material_string_class a crm:E33_Linguistic_Object ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300264237> ;\n  rdf:value ?material_string .\n\n\n######### DIMENSIONS STATEMENT #########\n?dimension_reference_class a crm:E33_Linguistic_Object ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300266036> ;  \n  rdf:value ?dimension_reference .\n\n\n######### DIMENSIONS #########\n?dimension_class a crm:E54_Dimension ;\n  rdf:value ?dimension_value ;\n  crm:P91_has_unit ?dimension_unit ;\n  crm:P2_has_type ?dimension_type.\n?dimension_type skos:prefLabel ?dimension_name.\n?dimension_unit rdfs:label ?dimension_unit_label.\n######### DIMENSION PARTS #########\n?part_class a crm:E18_Physical_Thing ;\n  rdfs:label ?part_name;\n  crm:P2_has_type ?part_type;\n  crm:P43_has_dimension ?part_dimension_class .\n?part_dimension_class a crm:E54_Dimension ;\n  rdf:value ?part_dimension_value ;\n  crm:P91_has_unit ?part_dimension_unit ;\n  crm:P2_has_type ?part_dimension_type.\n?part_dimension_type skos:prefLabel ?part_dimension_name.\n?part_dimension_unit rdfs:label ?part_dimension_unit_label.\n\n\n\n\n######### MARKS #########\n?mark_class a crm:E37_Mark ;\n  rdf:value ?mark .\n\n\n######### INSCRIPTIONS #########\n?inscription_class a crm:E34_Inscription ;\n  rdf:value ?inscription .\n\n\n######### PRIMARY DESCRIPTION #########\n?primary_description_class a crm:E33_Linguistic_Object ;\n  rdf:value ?description ;\n  crm:P94i_was_created_by ?authorship_event ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300404670> ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300080091> .\n?authorship_event a crm:E65_Creation ;\n    crm:P14_carried_out_by ?author_class .\n?author_class a crm:E39_Actor ;\n    rdfs:label ?author .\n\n######### ALTERNATE DESCRIPTION #########\n?alternate_description_class a crm:E33_Linguistic_Object ;\n  rdf:value ?alt_description ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300080091> ;\n  crm:P94i_was_created_by ?alt_desc_authorship_event .\n?alt_desc_authorship_event a crm:E65_Creation ;\n    crm:P14_carried_out_by ?alt_desc_author_class .\n?alt_desc_author_class a crm:E39_Actor ;\n    rdfs:label ?alt_desc_author .\n\n######### IMAGE #########\n?image a crm:E38_Image ;\n  rdfs:label ?image_description ;\n  rdf:value ?image_value ;\n  crm:P67i_is_referred_to_by ?image_rights_statement_class ;\n  crm:P104_is_subject_to ?image_right_class .\n?image_right a crm:E30_Right .\n?image_rights_statement_class a crm:E33_Linguistic_Object ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300055547> ;\n  rdf:value ?image_rights_statement .\n\n\n######### WEBSITE #########\n?website_url rdfs:label ?website_label.\n\n\n######### WEBSITE #########\n?owner rdfs:label ?owner_name ;\n  skos:exactMatch ?owner_lod_identifier . \n\n\n######### ACQUISITION #########\n?acquisition_event a crm:E8_Acquisition ;\n  crm:P22_transferred_title_to ?owner ;\n  crm:P4_has_time-span ?acquisition_timespan . \n?acquisition_timespan a crm:E52_Time-Span ; \n  crm:P82a_begin_of_the_begin ?acquisition_earliest_date ;\n  crm:P82b_end_of_the_end ?acquisition_latest_date ; \n  crm:P3_has_note ?display_date . \n\n######### OBJECT RIGHT #########\n?object_right a crm:E30_Right ;\n  crm:P3_has_note ?object_rights_text .\n\n######### DEPARTMENT AND COLLECTION #########\n?collection_class a crm:E19_Physical_Object ;\n  rdfs:label ?collection_name ;\n  crm:P49_has_former_or_current_keeper ?department_class .\n?department_class a crm:E74_Group ;\n  crm:P2_has_type <http://vocab.getty.edu/aat/300263534> ;\n  crm:P107i_is_current_or_former_member_of ?institution;\n  rdfs:label ?department_name .\n\n######### MATERIAL #########\n?material_class a crm:E57_Material ;\n  skos:broadMatch ?lod_material_term ;\n  skos:prefLabel ?material_name .\n\n######### STYLE OR PERIOD #########\n?style_event a crm:E17_Type_Assignment;\n  crm:P21_had_general_purpose <http://vocab.getty.edu/aat/300015646> ;\n  crm:P42_assigned ?style_class.\n?style_class a crm:E55_Type;\n  rdfs:label ?style_name . \n\n}\nWHERE {\n<' + urlVar + '> a crm:E22_Man-Made_Object.\n\n\n######### PRIMARY TITLE #########\nOPTIONAL {\n  <' + urlVar + '> crm:P102_has_title ?primary_title_class .\n  ?primary_title_class a crm:E35_Title ;\n    rdf:value ?primary_title_text ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300404670> .\n  OPTIONAL {\n    ?primary_title_class crm:P1_is_identified_by ?primary_title_id_class.\n    ?primary_title_id_class a crm:E42_Identifier;\n      crm:P2_has_type <http://vocab.getty.edu/aat/300404012> ;\n      rdf:value ?primary_title_id .\n  }\n}\n\n\n######### ALTERNATE TITLES #########\nOPTIONAL {\n  <' + urlVar + '> crm:P102_has_title ?alternate_title_class .\n  ?alternate_title_class a crm:E35_Title ;\n    rdf:value  ?alternate_title_text .\n  OPTIONAL {\n    ?alternate_title_class crm:P2_has_type ?alternate_title_type_class . \n    ?alternate_title_type_class a crm:E55_Type ;\n      skos:prefLabel ?alternate_title_type .\n  }\n  FILTER NOT EXISTS {?alternate_title_type_class crm:P2_has_type <http://vocab.getty.edu/aat/300404012> .}\n}\n\n\n######### OBJECT ID #########\nOPTIONAL {\n  <' + urlVar + '> crm:P1_is_identified_by ?object_id_class.\n  ?object_id_class a crm:E42_Identifier ;\n    rdf:value ?object_id ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300404621> .\n}\n\n######### OBJECT ID #########\nOPTIONAL {\n  <' + urlVar + '> crm:P1_is_identified_by ?preferred_identifier_class.\n  ?preferred_identifier_class a crm:E42_Identifier ;\n    rdf:value ?preferred_identifier ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300404670> .\n}\n\n######### ALTERNATE IDS #########\nOPTIONAL {\n  <' + urlVar + '> crm:P1_is_identified_by ?alternate_ids .\n  ?alternate_ids a crm:E42_Identifier ;\n    rdfs:value ?alternate_identifier .\n  \n  FILTER NOT EXISTS { ?alternate_ids crm:P2_has_type <http://vocab.getty.edu/aat/300404621>}\n  FILTER NOT EXISTS { ?alternate_ids crm:P2_has_type <http://vocab.getty.edu/aat/300312355>}\n  FILTER NOT EXISTS { ?alternate_ids crm:P2_has_type <http://vocab.getty.edu/aat/300404670>}\n\n  OPTIONAL {\n   ?alternate_ids crm:P2_has_type ?alternate_identifier_type .\n   OPTIONAL {\n     ?alternate_identifier_type skos:prefLabel ?alternate_identifier_type_label .\n   } \n  }\n}\n\n\n\n######### CREATION #########  \nOPTIONAL {\n  {\n    <' + urlVar + '> crm:P108i_was_produced_by ?production_event .\n  } UNION {\n    ?production_event crm:P108_has_produced <' + urlVar + '> .\n  } UNION {\n    <' + urlVar + '> crm:P108i_was_produced_by ?intermediate_event .\n    ?intermediate_event crm:P9_consists_of ?production_event .\n  }\n  ?production_event a crm:E12_Production ;\n    crm:P4_has_time-span ?production_timespan. \n  ?production_timespan a crm:E52_Time-Span.\n  OPTIONAL {\n    {\n     ?production_timespan crm:P82a_begin_of_the_begin ?earliest_date.\n     ?production_timespan crm:P82b_end_of_the_end ?latest_date.\n    } UNION {\n      ?production_timespan crm:P82_at_some_time_within ?earliest_date.\n      ?production_timespan crm:P82_at_some_time_within ?latest_date.\n    }\n  }\n  OPTIONAL {\n    {\n      ?production_timespan crm:P3_has_note ?display_date. \n    } UNION {\n      ?production_timespan skos:prefLabel ?display_date. \n    } UNION {\n      ?production_timespan rdfs:label ?display_date. \n    }\n  }\n}\n\n######### CREATION LOCATION #########\nOPTIONAL {\n  <' + urlVar + '> crm:P108i_was_produced_by ?production_event.\n  ?production_event crm:P7_took_place_at ?creation_location_class .\n  OPTIONAL {\n    ?creation_location_class a crm:E53_Place ;\n      rdfs:label ?creation_location.\n  }\n}\n\n######### CREATOR #########\nOPTIONAL {\n  <' + urlVar + '> crm:P108i_was_produced_by ?production_event.\n  ?production_event crm:P14_carried_out_by ?actor_class .\n  OPTIONAL {\n    ?actor_class a ?actor_type .\n  }\n  OPTIONAL {\n    ?actor_class rdfs:label ?actor_name.\n  }\n}\n\n\n######### ACCESSION NUMBER #########\nOPTIONAL {\n  <' + urlVar + '> crm:P1_is_identified_by ?accession_number_class .\n  ?accession_number_class a crm:E42_Identifier ;\n    rdf:value ?identifier ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300312355> .\n}\n\n\n######### CLASSIFICATION #########\nOPTIONAL {\n  <' + urlVar + '> crm:P41i_was_classified_by ?classification_event.\n  ?classification_event a crm:E17_Type_Assignment;\n    crm:P21_had_general_purpose <http://vocab.getty.edu/aat/300179869> ;\n    crm:P42_assigned ?classification_class.\n  OPTIONAL {\n    ?classification_class rdfs:label ?classification_name.\n  }\n}\n\n\n######### SUBJECT #########\nOPTIONAL {\n  <' + urlVar + '> crm:P62_depicts ?subject_class .\n  OPTIONAL {\n          {?subject_class rdfs:label      ?subject_name .}\n    UNION {?subject_class skos:prefLabel  ?subject_name .}\n    UNION {?subject_class crm:P3_has_note ?subject_name .}\n  }\n}\n\n\n######### CREDIT_LINE #########\nOPTIONAL {\n  <' + urlVar + '> crm:P67i_is_referred_to_by ?credit_line_class .\n  ?credit_line_class a crm:E33_Linguistic_Object;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300026687> ;\n    rdf:value ?credit_line .\n}\n\n\n######### MEDIUM_STATEMENT #########\nOPTIONAL {\n  <' + urlVar + '> crm:P67i_is_referred_to_by ?material_string_class .\n  ?material_string_class a crm:E33_Linguistic_Object ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300264237> ;\n    rdf:value ?material_string .\n}\n\n\n######### DIMENSIONS STATEMENT #########\nOPTIONAL {\n  <' + urlVar + '> crm:P67i_is_referred_to_by ?dimension_reference_class .\n  ?dimension_reference_class a crm:E33_Linguistic_Object;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300266036> ;\n    rdf:value ?dimension_reference .\n}\n\n\n######### DIMENSIONS #########\nOPTIONAL {\n  <' + urlVar + '> crm:P43_has_dimension ?dimension_class .\n  ?dimension_class a crm:E54_Dimension ;\n    rdf:value ?dimension_value ;\n    crm:P91_has_unit ?dimension_unit ;\n    crm:P2_has_type ?dimension_type .\n  OPTIONAL {\n    ?dimension_type skos:prefLabel ?dimension_name.\n  }\n  OPTIONAL {\n      ?dimension_unit rdfs:label ?dimension_unit_label.\n  }\n}  \n\n\n######### DIMENSION PARTS #########\nOPTIONAL {\n  <' + urlVar + '> crm:P46_is_composed_of ?part_class.\n  ?part_class a crm:E18_Physical_Thing ;\n    crm:P43_has_dimension ?part_dimension_class .\n  ?part_dimension_class a crm:E54_Dimension ;\n    rdf:value ?part_dimension_value ;\n    crm:P91_has_unit ?part_dimension_unit ;\n    crm:P2_has_type ?part_dimension_type .\n  OPTIONAL {\n    ?part_dimension_type skos:prefLabel ?part_dimension_name.\n  }\n  OPTIONAL {\n    ?part_class crm:P2_has_type ?part_type.\n  }\n  OPTIONAL {\n    ?part_class rdfs:label ?part_name.\n  }\n  OPTIONAL {\n      ?part_dimension_unit rdfs:label ?part_dimension_unit_label.\n  }\n}\n\n\n######### MARKS #########\nOPTIONAL {\n  <' + urlVar + '> crm:P65_shows_visual_item ?mark_class .\n  ?mark_class a crm:E37_Mark.\n  {\n    ?mark_class crm:P3_has_note ?mark. \n  } UNION {\n    ?mark_class rdf:value ?mark. \n  }\n}\n\n\n######### INSCRIPTIONS #########\nOPTIONAL {\n  <' + urlVar + '> crm:P65_shows_visual_item ?inscription_class .\n  ?inscription_class a crm:E34_Inscription.\n  {\n    ?inscription_class crm:P3_has_note ?inscription. \n  } UNION {\n    ?inscription_class rdf:value ?inscription. \n  }\n}\n\n\n######### PRIMARY DESCRIPTION #########\nOPTIONAL {\n  <' + urlVar + '> crm:P129i_is_subject_of ?primary_description_class .\n  ?primary_description_class a crm:E33_Linguistic_Object ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300404670> ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300080091> ;\n    rdf:value ?description .\n  OPTIONAL {\n    ?primary_description_class crm:P94i_was_created_by ?authorship_event .\n    ?authorship_event a crm:E65_Creation ;\n      crm:P14_carried_out_by ?author_class .\n    ?author_class a crm:E39_Actor;\n      rdfs:label ?author .\n  }\n}\n\n######### ALTERNATE DESCRIPTION #########\nOPTIONAL {\n  <' + urlVar + '> crm:P129i_is_subject_of ?alternate_description_class .\n  ?alternate_description_class a crm:E33_Linguistic_Object ;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300080091> ;\n    rdf:value ?alt_description .\n  OPTIONAL {\n    ?alternate_description_class crm:P94i_was_created_by ?alt_desc_authorship_event .\n    ?alt_desc_authorship_event a crm:E65_Creation ;\n      crm:P14_carried_out_by ?alt_desc_author_class .\n    ?alt_desc_author_class a crm:E39_Actor;\n      rdfs:label ?alt_desc_author .\n  }\n  FILTER NOT EXISTS {?alternate_description_class crm:P2_has_type <http://vocab.getty.edu/aat/300404670> }\n}\n\n######### IMAGE #########\nOPTIONAL {\n  <' + urlVar + '> crm:P138i_has_representation ?image .\n  ?image a crm:E38_Image .\n  OPTIONAL {\n    ?image rdfs:label ?image_description .\n  }\n  OPTIONAL {\n    ?image rdf:value ?image_value .\n  }\n  OPTIONAL {\n    ?image crm:P104_is_subject_to ?image_right_class .\n    ?image_right_class a crm:E30_Right .\n  }\n  OPTIONAL {\n    ?image crm:P67i_is_referred_to_by ?image_rights_statement_class .\n    ?image_rights_statement_class a crm:E33_Linguistic_Object ;\n      crm:P2_has_type <http://vocab.getty.edu/aat/300055547> ;\n      rdf:value ?image_rights_statement .\n  }\n}\n\n\n######### WEBPAGE #########\nOPTIONAL {\n  <' + urlVar + '> foaf:homepage ?website_url.\n  OPTIONAL {\n    ?website_url rdfs:label ?website_url_label.\n  }\n}\n\n\n######### OWNER #########\nOPTIONAL {\n  <' + urlVar + '> crm:P52_has_current_owner ?owner.\n  ?owner rdfs:label ?owner_name.\n  OPTIONAL {\n    ?owner skos:exactMatch ?owner_lod_identifier . \n  }\n}\n\n######### ACQUISITION #########\nOPTIONAL {\n  <' + urlVar + '> crm:P52_has_current_owner ?owner ;\n    crm:P24i_changed_ownership_through ?acquisition_event .\n  ?acquisition_event a crm:E8_Acquisition ;\n    crm:P22_transferred_title_to ?owner ;\n    crm:P4_has_time-span ?acquisition_timespan . \n  ?acquisition_timespan a crm:E52_Time-Span.\n  OPTIONAL {?acquisition_timespan crm:P82a_begin_of_the_begin ?earliest_date.}\n  OPTIONAL {?acquisition_timespan crm:P82b_end_of_the_end ?latest_date. }\n  OPTIONAL {?acquisition_timespan crm:P3_has_note ?display_date. }\n}\n\n######### OBJECT RIGHT #########\nOPTIONAL {\n  <' + urlVar + '> crm:P104_is_subject_to ?object_right .\n  ?object_right a crm:E30_Right.\n  OPTIONAL { ?object_right crm:P3_has_note ?object_rights_text .}\n}\n\n######### COLLECTION AND DEPARTMENT #########\nOPTIONAL {\n  <' + urlVar + '> crm:P46i_forms_part_of ?collection_class .\n  ?collection_class a crm:E19_Physical_Object ;\n    crm:P49_has_former_or_current_keeper ?department_class .\n  ?department_class a crm:E74_Group;\n    crm:P2_has_type <http://vocab.getty.edu/aat/300263534> ;\n    rdfs:label ?department_name .\n  OPTIONAL {\n    ?collection_class rdfs:label ?collection_name .\n  }\n  OPTIONAL {\n    ?department_class crm:P107i_is_current_or_former_member_of ?institution.\n  }\n}\n\n######### MATERIAL #########\nOPTIONAL {\n  <' + urlVar + '> crm:P45_consists_of ?material_class .\n  ?material_class a crm:E57_Material ;\n    skos:prefLabel ?material_name .\n  OPTIONAL {\n    ?material_class skos:broadMatch ?lod_material_term .\n  }\n}\n\n######### STYLE OR PERIOD #########\nOPTIONAL {\n  <' + urlVar + '> crm:P41i_was_classified_by ?style_event.\n  ?style_event a crm:E17_Type_Assignment;\n    crm:P21_had_general_purpose <http://vocab.getty.edu/aat/300015646> ;\n    crm:P42_assigned ?style_class.\n  OPTIONAL {\n    ?style_class rdfs:label ?style_name.\n  }\n}\n\n}';
    options.headers.accept = "application/ld+json";
    options.form =  { query:  dataString } ;

    fetchDataFromEndPoint.getData(options, function(err, results) {
        if (err) {
            console.log(err.stack);
            return res.status(500);
        }
        //res.json(results);
        // Used JSON Primer to compact the JSON
        jsonld.compact(results, jsonPrimer, function(err, compacted) {
            //res.json(compacted);
            compacted.musuem = "apple";
            res.json(compacted);


        }); //pack the JSON accroding to the context of
    });

});

router.get('/getrelatedartworks/artist/:artist', function(req, res, next){
    console.log('Get all related artifact for an artist');

    const artist = req.params.artist;
    console.log(artist);
    let dataString = 'PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>' +
        '\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>' +
        '\nPREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>' +
        '\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>' +
        '\nPREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>' +
        '\nSELECT ?sub ?name ?actorName ?begin_of_the_begin ?end_of_the_end ?placename WHERE {' +
        '\n  ?sub rdf:type  crm:E22_Man-Made_Object.' +
        '\n   ?sub crm:P102_has_title ?title.' +
        '\n ?title crm:P2_has_type <http://vocab.getty.edu/aat/300404670>.' +
        '\n ?title rdf:value ?name.' +
        '\n  ?sub crm:P108i_was_produced_by ?production.' +
        '\n ?production crm:P14_carried_out_by ?actor.' +
        '\n ?actor rdfs:label ?actorName.' +
        '\n  OPTIONAL{' +
        '\n  ?production crm:P4_has_time-span ?timespan.' +
        '\n    ?timespan crm:P82a_begin_of_the_begin ?begin_of_the_begin.' +
        '\n    ?timespan crm:P82b_end_of_the_end ?end_of_the_end.' +
        '\n  \n  }\n  OPTIONAL{' +
        '\n   ?production crm:P7_took_place_at ?place.' +
        '\n    ?place rdfs:label ?placename.}' +
        '\n\n FILTER regex(?actorName, "' + artist + '","i") ' +
        '\n}';

    options.form =  { query:  dataString } ;
    fetchDataFromEndPoint.getData(options, function(err, otherArtWorks) {
        if (err) {
            console.log(err.stack);
            return res.status(500);
        }
        //finalResults.artifacts.push(otherArtWorks.results.bindings);
        res.send(otherArtWorks);
    }); //getOtherArtWorks

});


module.exports = router;